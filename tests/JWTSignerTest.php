<?php

namespace Cerpus\JWTSupportTest;

use Cerpus\JWTSupport\JWTSigner;

class JWTSignerTest extends \PHPUnit_Framework_TestCase {
    private function getSampleData() {
        $sampleTokenData = 'eyJpc3MiOiJodHRwczovL2F1dGguYmI0YnRlc3QuY2VycHVzLm5ldC8iLCJzdWIiOiJjYTY1ODI3Ny1iZDU5LTQwMzAtYTBhOC00NjI3ZGI3YTk3ZjAiLCJuYW1lIjoiSG9zdG1hc3RlciIsImFwcF9tZXRhZGF0YSI6eyJpZGVudGl0eUlkIjoiY2E2NTgyNzctYmQ1OS00MDMwLWEwYTgtNDYyN2RiN2E5N2YwIiwiZmlyc3ROYW1lIjoiQ2VycHVzIEFTIiwibGFzdE5hbWUiOiJIb3N0bWFzdGVyIiwiZGlzcGxheU5hbWUiOiJIb3N0bWFzdGVyIiwiZW1haWwiOiJob3N0bWFzdGVyQGNlcnB1cy5jb20iLCJhZGRpdGlvbmFsRW1haWxzIjpbXSwibm90VmVyaWZpZWRFbWFpbHMiOltdLCJhZG1pbiI6dHJ1ZX0sImV4cCI6MTUxMDkxNTMwNywiaWF0IjoxNTEwOTE0NzA3fQ';
        $jsonData = base64_decode($sampleTokenData, true);
        return json_decode($jsonData);
    }

    public function testSignSample() {
        $privKey = 'MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCl9mhTRKizJnMeNp-U5nQydglb0J8lWxPfp8CjoJ7A8wUReYZvNnr23VeVejWkEbhyFtOvWaZRlazmtCvbxlGiSG57_5n_NE3aJEaFHNIACHcgeBTeMigzGRq5hD5YGJ9KdEjkp7Fvol-C09adaSkZroZnCiHthQmxuFITuQc7omc_2vX-TWn3sGD0On0WLgmeBwEB-R3bWBHe5ezbIlD68vN0-HHKfa2Vs-D0XU5-lDLL5Zs9SWumXKyiwtztrfPBVW5k4lJJQpGUCSl6JhHPHdYyVWQd721LAEl6f7VU8uNLykDrpx6lnEof6JuyKsaa6CU4azQsafMs5XX0LtRlAgMBAAECggEATcx_B1nOQ30oxecRU_ncSrNum63mjNpvLI81DP-ErCrAG3r-fC_r4MHOBvJtJuZvsnvk6_R4tRIXJWcckEAdkJenw1UE2c-pFzOeI1RpVT6iqYPhNHAKzDlef8zwdNfGBF8StK2vzgcuAuRPXSco7zMTKkZjtTaCXt9rCnfYXil3NWZ8oL1PKmGvwvYwvaQrALEj3vUQBAR9bA10-5XVzPW8hMrfhzNs4JS3f02WIETwdF0kY3ow54HLSA7AW42vD7_pxbnVdx4De40uM2ziD9GVK-qDy-xtmakJyoYU2N-3AbqLf75HjJOml9MBkkOglJwH1ryBg-LtUPGAFOsNWQKBgQDksQvLyisR8bWDMeojiOfXBj0xTmZbN66JVMI7htelv08mINMspga_Mv1TjPX9mx37fvMKFs7ZYYrdpITYmkU2kl5GHd3Jkan_FEYknWdmjiZM8CsuUYVmQNJnS6-XSHNXCNSHYb6YL2uyHwJEYuZp0QqVYliicVE8k-BWRqjmZwKBgQC5x8ZU9RJ2W3efpBl9O_jQYB_EiOKMCKsJtcM5QwCtxrOJ6XlpdMSgH7zNIghLKCG7bl2JfuKHMFCpEEHpxma756l3ZFXzwJVEeXTo02LpnEwbEd7iVWdD1cb-qwGE962hFN3Zc22jnos6ZbaVINwtyiTJbROVcaoPefLVQzQ3UwKBgQDeX0GnIaiLxErJjYmsj_1P2qM6BJAG9rfileZgV5ftdX8TBiwRaEd7N6uYyKKRvXmECUducgsk2XJcXxNGQ4w1qlG9QGFfFSMGA8LI672VvXeErKxwV5itey6cfr35DtwIr29pTSQ1ezbvdrOPp9OA5WGzLHQfUKy7iNdFTWQC1QKBgQCmPB450vjsMzg8_sdYChu_yONkJuAgUXlKPPws9slatZvdYa6kMDno1b1JCJTHO2fDoSPNbl4gfZkPTl7MYh13MfmvvXYzoDVwigWUd-HgC10GM91uROEcD-P56OZ5Jm6U3mkMtH58k9cdL_pKQpcB2glEu3d0l7qGEqa5MWM9xQKBgF4zdWijK3Pb9wNh1m3PH_BYOae33tKfNnwjg1VmktkshZnDW1CXoyl8Agx1gxshnbHomFzPikSss49u_ciaPd14PxzsxJPkTHIuyJm2LRW2L-f5D9REuDIoBrfQBglhNZNzU5wb6v3l7D-hL0EraYSfM9ImxvRwKEJ3q3_wW9VZ';
        //$pubKey = 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApfZoU0SosyZzHjaflOZ0MnYJW9CfJVsT36fAo6CewPMFEXmGbzZ69t1XlXo1pBG4chbTr1mmUZWs5rQr28ZRokhue_-Z_zRN2iRGhRzSAAh3IHgU3jIoMxkauYQ-WBifSnRI5Kexb6JfgtPWnWkpGa6GZwoh7YUJsbhSE7kHO6JnP9r1_k1p97Bg9Dp9Fi4JngcBAfkd21gR3uXs2yJQ-vLzdPhxyn2tlbPg9F1OfpQyy-WbPUlrplysosLc7a3zwVVuZOJSSUKRlAkpeiYRzx3WMlVkHe9tSwBJen-1VPLjS8pA66cepZxKH-ibsirGmuglOGs0LGnzLOV19C7UZQIDAQAB';

        $signer = new JWTSigner($privKey);
        $jwt = $signer->sign($this->getSampleData());
        $this->assertEquals('eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczpcL1wvYXV0aC5iYjRidGVzdC5jZXJwdXMubmV0XC8iLCJzdWIiOiJjYTY1ODI3Ny1iZDU5LTQwMzAtYTBhOC00NjI3ZGI3YTk3ZjAiLCJuYW1lIjoiSG9zdG1hc3RlciIsImFwcF9tZXRhZGF0YSI6eyJpZGVudGl0eUlkIjoiY2E2NTgyNzctYmQ1OS00MDMwLWEwYTgtNDYyN2RiN2E5N2YwIiwiZmlyc3ROYW1lIjoiQ2VycHVzIEFTIiwibGFzdE5hbWUiOiJIb3N0bWFzdGVyIiwiZGlzcGxheU5hbWUiOiJIb3N0bWFzdGVyIiwiZW1haWwiOiJob3N0bWFzdGVyQGNlcnB1cy5jb20iLCJhZGRpdGlvbmFsRW1haWxzIjpbXSwibm90VmVyaWZpZWRFbWFpbHMiOltdLCJhZG1pbiI6dHJ1ZX0sImV4cCI6MTUxMDkxNTMwNywiaWF0IjoxNTEwOTE0NzA3fQ.XHgr5esTM1W9cPdi4gjjgLlujaRDmb7AKZhqqj3P8i7nkGNYsGj0P3k6bP7E1DEDLa8J5_QnFtTed8-X6WbN34r3nR6kSOXjz2ypFERPLjBr79gVgV9aglxYv6Ks038rNOwFWD4Tz5t4mTTpWe8exeXsR_CDC2ncYloRVtLa7ORekiMHU-quskwyWeOVCoQheJ8dfY7obb-pMtQRMaq3zWvvVgTjg4Kiqiutops_2OzhPMNwx-G_s4Noiopkn6hpvydK59ESfePCM6C-J2S9AInAjTBJkjcJun9ei8yAIeV-xFgehBLpnfdDuDTy7Fn9sZzviy9aHtBOxToKZ15cmQ', $jwt);
    }
}